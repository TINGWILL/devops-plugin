# DevOps部署任务管理插件需求文档

## 1. 项目概述
基于飞书项目开发的DevOps部署任务管理插件，用于管理应用的部署流程，支持多应用批量部署、状态追踪和管理操作。插件提供完整的部署任务生命周期管理，包括任务创建、状态流转、批量操作等功能。

## 2. 业务流程
### 2.1 应用添加流程
1. 进入DevOps部署任务管理插件页面
2. 点击右上角「新增应用」按钮，打开添加应用弹窗
3. 在弹窗中填写1～N组应用信息，每组包含：
   - 应用名称（必填）
   - 制品仓库（必填）
   - 制品版本（必填）
4. 每组应用可进行复制或移除操作
5. 点击「确认」按钮，生成部署任务并刷新列表

### 2.2 部署任务管理流程
1. 部署任务生成成功后，在表格中展示所有任务
2. 表格包含以下信息（按显示顺序）：
   - 应用名称（固定左侧列）
   - 部署状态（带颜色标签）
   - 版本号
   - 发布集群
   - 命名空间
   - 环境标签
   - Pod状态
   - 部署时间
   - 部署人（带头像）
   - 操作（固定右侧列）
3. 支持单条任务的部署、删除操作
4. 支持多条任务的批量部署操作
5. 支持复选框选择，选中时显示批量部署按钮

### 2.3 部署任务状态流转
根据部署任务状态流图，状态流转如下：
- **待部署**：任务创建但未开始部署（灰色标签）
- **部署中**：任务正在进行部署（蓝色标签）
- **审批中**：任务等待审批（蓝色标签）
- **部署完成**：任务部署成功（蓝色标签）
- **验证通过**：验证成功（绿色标签）
- **验证失败**：验证失败，需要重新部署（红色标签）
- **部署失败**：部署过程失败（红色标签）
- **部署终止**：手动终止部署流程（红色标签）

### 2.4 操作权限控制
- **部署按钮**：仅在"待部署"和"部署完成"状态时可点击
- **删除按钮**：在"验证通过"、"验证失败"、"部署终止"状态时禁用
- **批量部署**：仅对"待部署"和"部署完成"状态的任务生效

## 3. 功能需求
### 3.1 应用管理
- 支持添加、复制、移除应用
- 支持批量添加应用（最多N组）
- 表单验证（必填字段检查）
- 动态表单行管理（添加、复制、删除行）

### 3.2 部署任务管理
- 查看部署任务列表（分页显示，每页10条）
- 单条任务部署、删除操作
- 批量任务部署操作
- 任务状态实时更新
- 部署过程模拟（3秒完成）

### 3.3 表格功能
- 固定列：复选框、应用名称、操作列
- 筛选功能：应用名称、发布集群、命名空间、环境标签
- 排序功能：版本号、部署时间、应用名称
- 横向滚动支持
- 响应式布局

### 3.4 状态管理
- 实时更新部署任务状态
- 状态颜色标签展示
- 状态流转逻辑控制
- 操作按钮状态联动

### 3.5 批量操作
- 复选框选择任务
- 批量部署按钮（选中时显示）
- 批量操作权限控制
- 操作结果反馈

## 4. UI/UX需求
### 4.1 界面设计
- 界面简洁、直观，符合飞书设计风格
- 使用Semi Design组件库，保持设计一致性
- 标题区域：左侧蓝色竖条 + "部署任务"文字，右侧操作按钮
- 表格区域：固定表头，支持横向滚动

### 4.2 交互设计
- 表单交互流畅，提供即时反馈
- 操作按钮状态明确（启用/禁用）
- 弹窗确认操作，防止误操作
- Toast提示操作结果

### 4.3 表格功能
- 支持排序功能（版本号、部署时间、应用名称）
- 支持筛选功能（应用名称、发布集群、命名空间、环境标签）
- 固定列：复选框、应用名称、操作列
- 分页显示，每页10条数据
- 横向滚动支持，滚动宽度1500px

### 4.4 状态展示
- 状态使用颜色标签区分：
  - 灰色：待部署
  - 蓝色：部署中、审批中、部署完成
  - 绿色：验证通过
  - 红色：验证失败、部署失败、部署终止
- Pod状态：运行中、等待中、失败
- 环境标签：使用蓝色标签展示

## 5. 技术栈要求
- 前端框架：React 18 + TypeScript
- UI组件库：Semi Design (@douyinfe/semi-ui)
- 图标库：Semi Icons (@douyinfe/semi-icons)
- 日期处理：date-fns
- 构建工具：Vite
- 样式方案：CSS-in-JS (内联样式)

## 6. 数据模型
### 6.1 应用表单模型
```typescript
interface AppFormItem {
  key: string;           // 表单行唯一标识
  appName: string;       // 应用名称
  artifactRepo: string;  // 制品仓库
  artifactVersion: string; // 制品版本
}
```

### 6.2 部署任务模型
```typescript
interface DataItem {
  key: string;           // 任务唯一标识
  appName: string;       // 应用名称
  deployStatus: string;  // 部署状态 (success/failed/pending)
  podStatus: string;     // Pod状态 (running/pending/failed)
  version: string;       // 版本号
  cluster: string;       // 发布集群
  namespace: string;     // 命名空间
  envTag: string;        // 环境标签
  deployTime: number;    // 部署时间 (时间戳)
  deployer: string;      // 部署人
  avatarBg: string;      // 头像背景色
  taskStatus: string;    // 任务状态 (待部署/部署中/部署完成/验证通过/验证失败/部署失败/审批中/部署终止)
}
```

### 6.3 状态配置模型
```typescript
const TASK_STATUS_CONFIG = {
  '待部署': { color: 'grey', text: '待部署' },
  '部署中': { color: 'blue', text: '部署中' },
  '审批中': { color: 'blue', text: '审批中' },
  '部署完成': { color: 'blue', text: '部署完成' },
  '验证通过': { color: 'green', text: '验证通过' },
  '验证失败': { color: 'red', text: '验证失败' },
  '部署失败': { color: 'red', text: '部署失败' },
  '部署终止': { color: 'red', text: '部署终止' }
};
```

## 7. 非功能需求
### 7.1 性能要求
- 页面加载时间 < 3秒
- 操作响应时间 < 1秒
- 表格渲染性能优化
- 内存使用合理

### 7.2 兼容性要求
- 支持Chrome、Firefox、Safari等主流浏览器
- 响应式设计，适配不同屏幕尺寸
- 移动端兼容性

### 7.3 可维护性要求
- 代码结构清晰，组件化开发
- TypeScript类型定义完整
- 注释完善，文档齐全
- 遵循代码规范

### 7.4 可扩展性要求
- 支持后续功能迭代和扩展
- 组件可复用
- 状态管理可扩展

## 8. 实现计划
### 8.1 已完成功能 ✅
1. ✅ 基础框架搭建（React + TypeScript + Vite）
2. ✅ UI组件实现（Semi Design组件库）
3. ✅ 部署任务列表展示
4. ✅ 单个任务部署、删除操作
5. ✅ 批量任务部署操作
6. ✅ 新增应用功能
7. ✅ 状态管理和流转
8. ✅ 表格筛选和排序
9. ✅ 固定列和响应式布局

### 8.2 待优化功能 ⚠️
1. 组件拆分和重构
2. 性能优化
3. 错误处理完善
4. 测试用例编写
5. 文档完善

## 9. 技术实现细节
### 9.1 状态管理
- 使用React Hooks进行状态管理
- 主要状态：dataSource、selectedRowKeys、appFormItems
- 状态更新使用函数式更新模式

### 9.2 组件设计
- 使用函数式组件和Hooks
- 组件职责单一，逻辑清晰
- 支持Props类型检查

### 9.3 样式实现
- 使用内联样式和CSS类
- 固定列使用CSS sticky定位
- 响应式布局支持

### 9.4 数据模拟
- 使用Mock数据模拟真实场景
- 支持46条测试数据
- 状态流转模拟（3秒完成）

## 10. 功能特性对比

### 10.1 需求实现对比表

| 功能模块 | 原始需求 | 当前实现 | 实现状态 | 备注 |
|---------|---------|---------|---------|------|
| 应用添加 | 支持添加1～N组应用 | ✅ 支持动态添加多组应用 | 已完成 | 包含复制、删除行功能 |
| 表单验证 | 必填字段检查 | ✅ 完整表单验证 | 已完成 | 应用名称、制品仓库、制品版本 |
| 任务列表 | 展示所有部署任务 | ✅ 分页展示，每页10条 | 已完成 | 支持46条测试数据 |
| 单个操作 | 单条任务部署、删除 | ✅ 部署、删除操作 | 已完成 | 包含权限控制 |
| 批量操作 | 批量部署、删除 | ✅ 批量部署 | 已完成 | 删除功能待实现 |
| 状态管理 | 状态流转展示 | ✅ 8种状态完整流转 | 已完成 | 包含颜色标签 |
| 表格功能 | 排序、筛选 | ✅ 排序、筛选功能 | 已完成 | 4个字段支持筛选 |
| 固定列 | 无明确要求 | ✅ 复选框、应用名称、操作列 | 已完成 | 响应式布局 |
| 权限控制 | 无明确要求 | ✅ 操作按钮权限控制 | 已完成 | 基于状态控制 |
| 批量选择 | 无明确要求 | ✅ 复选框选择 | 已完成 | 选中时显示批量按钮 |

### 10.2 新增功能特性

| 功能特性 | 描述 | 实现状态 |
|---------|------|---------|
| 状态颜色标签 | 8种状态使用不同颜色区分 | ✅ 已完成 |
| 操作权限控制 | 基于任务状态控制按钮可用性 | ✅ 已完成 |
| 批量部署按钮 | 选中任务时动态显示 | ✅ 已完成 |
| 部署过程模拟 | 3秒模拟部署完成 | ✅ 已完成 |
| 响应式布局 | 支持横向滚动和固定列 | ✅ 已完成 |
| 头像展示 | 部署人信息带头像 | ✅ 已完成 |
| 环境标签 | 使用蓝色标签展示 | ✅ 已完成 |
| 操作反馈 | Toast提示操作结果 | ✅ 已完成 |

## 11. 注意事项
- 使用React函数式组件和Hooks
- 遵循Semi Design组件库的使用规范
- 代码风格保持一致
- 确保代码可读性和可维护性
- 注意性能优化和用户体验
- 完善错误处理和边界情况
- 当前实现已超出原始需求，提供了更丰富的功能特性